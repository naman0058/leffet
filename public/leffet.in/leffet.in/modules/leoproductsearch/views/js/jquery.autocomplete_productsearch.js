var matched,browser;jQuery.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},browser={},(matched=jQuery.uaMatch(navigator.userAgent)).browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),jQuery.browser=browser,function(x){x.fn.extend({autocomplete:function(e,t){var a="string"==typeof e;return(t=x.extend({},x.Autocompleter.defaults,{url:a?e:null,data:a?null:e,delay:a?x.Autocompleter.defaults.delay:10,max:t&&!t.scroll?10:150},t)).highlight=t.highlight||function(e){return e},t.formatMatch=t.formatMatch||t.formatItem,this.each(function(){new x.Autocompleter(this,t)})},result:function(e){return this.bind("result",e)},search:function(e){return this.trigger("search",[e])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(e){return this.trigger("setOptions",[e])},unautocomplete:function(){return this.trigger("unautocomplete")}}),x.Autocompleter=function(o,i){var t,n,a,l={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},s=x(o).attr("autocomplete","off").addClass(i.inputClass),u=s.parent().find(".leoproductsearch-loading"),c="",h=x.Autocompleter.Cache(i),f=0,e={mouseDownOnSelect:!1},m=x.Autocompleter.Select(i,o,r,e);function r(){var e=m.selected();if(!e)return!1;var t,a=e.result;return c=a,i.multiple&&(1<(t=d(s.val())).length&&(a=t.slice(0,t.length-1).join(i.multipleSeparator)+i.multipleSeparator+a),a+=i.multipleSeparator),s.val(a),v(),s.trigger("result",[e.data,e.value]),!0}function p(e,t){var a;n!=l.DEL?(a=s.val(),!t&&a==c||((a=g(c=a)).length>=i.minChars?(s.addClass(i.loadingClass),i.matchCase||(a=a.toLowerCase()),b(a,w,v)):(C(),m.hide()))):m.hide()}function d(e){if(!e)return[""];var t=e.split(i.multipleSeparator),a=[];return x.each(t,function(e,t){x.trim(t)&&(a[e]=x.trim(t))}),a}function g(e){if(!i.multiple)return e;var t=d(e);return t[t.length-1]}function v(){var e=m.visible();m.hide(),clearTimeout(t),C(),i.mustMatch&&s.search(function(e){var t;e||(i.multiple?(t=d(s.val()).slice(0,-1),s.val(t.join(i.multipleSeparator)+(t.length?i.multipleSeparator:""))):s.val(""))}),e&&x.Autocompleter.Selection(o,o.value.length,o.value.length)}function w(e,t){var a,r;t&&t.length&&f?(C(),m.display(t,e),a=e,r=t[0].value,i.autoFill&&g(s.val()).toLowerCase()==a.toLowerCase()&&n!=l.BACKSPACE&&(s.val(s.val()+r.substring(g(c).length)),x.Autocompleter.Selection(o,c.length,c.length+r.length)),m.show()):v()}function b(a,r,e){u.show(),i.matchCase||(a=a.toLowerCase());var n,t=h.load(a);t&&t.length?r(a,t):"string"==typeof i.url&&0<i.url.length?(n={timestamp:+new Date},x.each(i.extraParams,function(e,t){n[e]="function"==typeof t?t():t}),x.ajax({mode:"abort",port:"autocomplete"+o.name,dataType:i.dataType,url:i.url,data:x.extend({cate:x('input[name="cate"]').val(),q:g(a),limit:i.max},n),success:function(e){var t=i.parse&&i.parse(e)||function(e){for(var t=[],a=e.split("\n"),r=0;r<a.length;r++){var n=x.trim(a[r]);n&&(n=n.split("|"),t[t.length]={data:n,value:n[0],result:i.formatResult&&i.formatResult(n,n[0])||n[0]})}return t}(e);r(a,t),u.hide()}})):(m.emptyList(),e(a))}function C(){s.removeClass(i.loadingClass)}x.browser.opera&&x(o.form).bind("submit.autocomplete",function(){if(a)return a=!1}),s.bind((x.browser.opera?"keypress":"keydown")+".autocomplete",function(e){switch(n=e.keyCode,e.keyCode){case l.UP:e.preventDefault(),m.visible()?m.prev():p(0,!0);break;case l.DOWN:e.preventDefault(),m.visible()?m.next():p(0,!0);break;case l.PAGEUP:e.preventDefault(),m.visible()?m.pageUp():p(0,!0);break;case l.PAGEDOWN:e.preventDefault(),m.visible()?m.pageDown():p(0,!0);break;case i.multiple&&","==x.trim(i.multipleSeparator)&&l.COMMA:case l.TAB:case l.RETURN:if(r())return e.preventDefault(),!(a=!0);break;case l.ESC:m.hide();break;default:clearTimeout(t),t=setTimeout(p,i.delay)}}).focus(function(){f++}).blur(function(){f=0,e.mouseDownOnSelect||(clearTimeout(t),t=setTimeout(v,200))}).click(function(){1<f++&&!m.visible()&&p(0,!0)}).bind("search",function(){var n=1<arguments.length?arguments[1]:null;function a(e,t){var a;if(t&&t.length)for(var r=0;r<t.length;r++)if(t[r].result.toLowerCase()==e.toLowerCase()){a=t[r];break}"function"==typeof n?n(a):s.trigger("result",a&&[a.data,a.value])}x.each(d(s.val()),function(e,t){b(t,a,a)})}).bind("flushCache",function(){h.flush()}).bind("setOptions",function(){x.extend(i,arguments[1]),"data"in arguments[1]&&h.populate()}).bind("unautocomplete",function(){m.unbind(),s.unbind(),x(o.form).unbind(".autocomplete")})},x.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results lps_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:10,max:100,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(e){return e[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:", ",highlight:function(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180},x.Autocompleter.Cache=function(s){var o={},i=0;function l(e,t){s.matchCase||(e=e.toLowerCase());var a=e.indexOf(t);return-1!=a&&(0==a||s.matchContains)}function u(e,t,a){i>s.cacheLength&&r(),o[e]||i++,o[e]=a}function e(){if(!s.data)return!1;var e={},t=0;s.url||(s.cacheLength=1),e[""]=[];for(var a=0,r=s.data.length;a<r;a++){var n,o,i="string"==typeof(i=s.data[a])?[i]:i,l=s.formatMatch(i,a+1,s.data.length);!1!==l&&(e[n=l.charAt(0).toLowerCase()]||(e[n]=[]),o={value:l,data:i,result:s.formatResult&&s.formatResult(i)||l},e[n].push(o),t++<s.max&&e[""].push(o))}x.each(e,function(e,t){s.cacheLength++,u(e)})}function r(){o={},i=0}return setTimeout(e,25),{flush:r,add:u,populate:e,load:function(a){if(!s.cacheLength||!i)return null;if(!s.url&&s.matchContains){var r=[];for(var e in o){0<e.length&&(t=o[e],x.each(t,function(e,t){l(t.value,a)&&r.push(t)}))}return r}if(o[a])return o[a];if(s.matchSubset)for(var t,n=a.length-1;n>=s.minChars;n--){if(t=o[a.substr(0,n)]){r=[];return x.each(t,function(e,t){l(t.value,a)&&(r[r.length]=t)}),r}}return null}}},x.Autocompleter.Select=function(o,a,r,n){var i,l,s,u,c="ac_over",h=-1,f="",m=!0;function p(e){for(var t=e.target;t&&"LI"!=t.tagName;)t=t.parentNode;return t||[]}function e(e){i.slice(h,h+1).removeClass(c),(h+=e)<0?h=i.size()-1:h>=i.size()&&(h=0);var t,a=i.slice(h,h+1).addClass(c);o.scroll&&(t=0,i.slice(0,h).each(function(){t+=this.offsetHeight}),t+a[0].offsetHeight-u.scrollTop()>u[0].clientHeight?u.scrollTop(t+a[0].offsetHeight-u.innerHeight()):t<u.scrollTop()&&u.scrollTop(t))}function d(){u.empty();for(var e,t,a,r=(e=l.length,o.max&&o.max<e?o.max:e),n=0;n<r;n++){l[n]&&(!1!==(t=o.formatItem(l[n].data,n+1,r,l[n].value,f))&&(a=x("<li/>").html(o.highlight(t,f)).addClass(n%2==0?"ac_even":"ac_odd").appendTo(u)[0],x.data(a,"ac_data",l[n])))}i=u.find("li"),o.selectFirst&&(i.slice(0,1).addClass(c),h=0),x.fn.bgiframe&&u.bgiframe()}return{display:function(e,t){m&&(s=x("<div/>").hide().addClass(o.resultsClass).css("position","absolute").appendTo(".leoproductsearch-result"),u=x("<ul/>").appendTo(s).mouseover(function(e){p(e).nodeName&&"LI"==p(e).nodeName.toUpperCase()&&(h=x("li",u).removeClass(c).index(p(e)),x(p(e)).addClass(c))}).click(function(e){return x(p(e)).addClass(c),r(),a.focus(),!1}).mousedown(function(){n.mouseDownOnSelect=!0}).mouseup(function(){n.mouseDownOnSelect=!1}),0<o.width&&s.css("width",o.width),m=!1),l=e,f=t,d()},next:function(){e(1)},prev:function(){e(-1)},pageUp:function(){e(0!=h&&h-8<0?-h:-8)},pageDown:function(){h!=i.size()-1&&h+8>i.size()?e(i.size()-1-h):e(8)},hide:function(){s&&s.hide(),i&&i.removeClass(c),h=-1},visible:function(){return s&&s.is(":visible")},current:function(){return this.visible()&&(i.filter("."+c)[0]||o.selectFirst&&i[0])},show:function(){var e,t;x(a).offset();s.css({width:"string"==typeof o.width||0<o.width?o.width:x(a).width()+parseInt(x(a).css("padding-left"))+parseInt(x(a).css("padding-right"))+parseInt(x(a).css("margin-left"))+parseInt(x(a).css("margin-right")),top:"100%",left:0}).show(),o.scroll&&(u.css({maxHeight:o.scrollHeight,overflow:"auto"}),x.browser.msie&&void 0===document.body.style.maxHeight&&(e=0,i.each(function(){e+=this.offsetHeight}),t=e>o.scrollHeight,u.css("height",t?o.scrollHeight:e),t||i.width(u.width()-parseInt(i.css("padding-left"))-parseInt(i.css("padding-right")))))},selected:function(){var e=i&&i.filter("."+c).removeClass(c);return e&&e.length&&x.data(e[0],"ac_data")},emptyList:function(){u&&u.empty()},unbind:function(){s&&s.remove()}}},x.Autocompleter.Selection=function(e,t,a){var r;e.createTextRange?((r=e.createTextRange()).collapse(!0),r.moveStart("character",t),r.moveEnd("character",a),r.select()):e.setSelectionRange?e.setSelectionRange(t,a):e.selectionStart&&(e.selectionStart=t,e.selectionEnd=a),e.focus()}}(jQuery);